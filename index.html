<!DOCTYPE html>
<html lang="ka">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Magazia App</title>
    <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.0/dist/JsBarcode.all.min.js"></script>
    <script src="https://unpkg.com/html5-qrcode"></script>
    <style>
        body { font-family: sans-serif; text-align: center; padding: 20px; background: #f4f4f4; }
        .screen { display: none; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
        .active { display: block; }
        input { display: block; margin: 10px auto; padding: 10px; width: 80%; }
        button { padding: 10px 20px; cursor: pointer; margin: 5px; border: none; border-radius: 5px; }
        .btn-green { background: #2ecc71; color: white; }
        .btn-blue { background: #3498db; color: white; }
        #reader { width: 300px; margin: 20px auto; }
        #barcode-img { margin-top: 20px; }
    </style>
</head>
<body>

    <div id="login-screen" class="screen active">
        <h2>მაღაზიის რეგისტრაცია</h2>
        <input type="text" id="shopName" placeholder="მაღაზიის სახელი">
        <button class="btn-green" onclick="showScreen('add-screen')">რეგისტრაცია</button>
    </div>

    <div id="add-screen" class="screen">
        <h2>პროდუქტის დამატება</h2>
        <input type="text" id="pName" placeholder="პროდუქტის სახელი">
        <input type="number" id="pPrice" placeholder="ფასი">
        <button class="btn-blue" onclick="generateProduct()">ბარკოდის შექმნა</button>
        <svg id="barcode-img"></svg>
        <div id="next-btn-cont" style="display:none;">
            <button class="btn-green" onclick="showScreen('scan-screen'); startScanner();">სკანირებაზე გადასვლა</button>
        </div>
    </div>

    <div id="scan-screen" class="screen">
        <h2>დაასკანირეთ პროდუქტი</h2>
        <div id="reader"></div>
        <div id="result-info" style="margin-top:20px; font-weight:bold;"></div>
        
        <div id="payment-btns" style="display:none;">
            <button class="btn-blue" onclick="fakePay('card')">Pay with Card</button>
            <button class="btn-green" onclick="fakePay('cash')">Pay with Cash</button>
        </div>
        <button onclick="location.reload()">თავიდან დაწყება</button>
    </div>

    <script>
        let myProduct = { name: "", price: "", code: "" };

        function showScreen(id) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
        }

        function generateProduct() {
            myProduct.name = document.getElementById('pName').value;
            myProduct.price = document.getElementById('pPrice').value;
            myProduct.code = Math.floor(100000 + Math.random() * 900000).toString();

            JsBarcode("#barcode-img", myProduct.code);
            document.getElementById('next-btn-cont').style.display = 'block';
        }

        function startScanner() {
            const html5QrCode = new Html5Qrcode("reader");
            html5QrCode.start(
                { facingMode: "environment" }, 
                { fps: 10, qrbox: { width: 250, height: 150 } },
                (decodedText) => {
                    if (decodedText === myProduct.code) {
                        document.getElementById('result-info').innerText = `ნაპოვნია: ${myProduct.name} - ${myProduct.price}₾`;
                        document.getElementById('payment-btns').style.display = 'block';
                        html5QrCode.stop();
                    } else {
                        alert("ეს თქვენთვის არ არის!");
                    }
                }
            );
        }

        function fakePay(type) {
            if (type === 'card') {
                alert("დაადეთ ბარათი კამერას!");
                setTimeout(() => {
                    alert("გადახდილია! ✅ (სიმულაცია)");
                }, 2000);
            } else {
                alert("მიიღეთ ნაღდი ფული: " + myProduct.price + "₾");
            }
        }
    </script>
</body>
</html>
