<!DOCTYPE html>
<html lang="ka">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Magazia App - Saved Mode</title>
    <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.0/dist/JsBarcode.all.min.js"></script>
    <script src="https://unpkg.com/html5-qrcode"></script>
    <style>
        body { font-family: 'Segoe UI', sans-serif; text-align: center; padding: 20px; background: #eceff1; }
        .screen { background: white; padding: 25px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); max-width: 400px; margin: auto; }
        input, .file-input { display: block; margin: 15px auto; padding: 12px; width: 90%; border: 1px solid #ddd; border-radius: 8px; }
        button { padding: 12px 25px; cursor: pointer; margin: 8px; border: none; border-radius: 8px; font-weight: bold; transition: 0.3s; width: 90%; }
        .btn-green { background: #27ae60; color: white; }
        .btn-blue { background: #2980b9; color: white; }
        .btn-red { background: #e74c3c; color: white; margin-top: 20px; }
        #reader { width: 100%; margin-top: 20px; border-radius: 10px; overflow: hidden; }
        #product-preview { width: 150px; height: 150px; object-fit: cover; border-radius: 10px; margin: 15px auto; display: none; }
        .hidden { display: none; }
        #barcode-img { margin: 20px 0; }
    </style>
</head>
<body>

    <div class="screen">
        <h2>áƒ›áƒáƒ¦áƒáƒ–áƒ˜áƒ˜áƒ¡ áƒáƒáƒœáƒ”áƒšáƒ˜</h2>
        
        <div id="add-section">
            <input type="text" id="pName" placeholder="áƒáƒ áƒáƒ“áƒ£áƒ¥áƒ¢áƒ˜áƒ¡ áƒ¡áƒáƒ®áƒ”áƒšáƒ˜">
            <input type="number" id="pPrice" placeholder="áƒ¤áƒáƒ¡áƒ˜ (â‚¾)">
            <label style="font-size: 12px; color: #666;">áƒáƒ¢áƒ•áƒ˜áƒ áƒ—áƒ”áƒ— áƒáƒ áƒáƒ“áƒ£áƒ¥áƒ¢áƒ˜áƒ¡ áƒ¤áƒáƒ¢áƒ:</label>
            <input type="file" id="pImage" accept="image/*" class="file-input" onchange="previewFile()">
            <img id="product-preview" src="#" alt="áƒáƒ áƒáƒ“áƒ£áƒ¥áƒ¢áƒ˜áƒ¡ áƒ¤áƒáƒ¢áƒ">
            <button class="btn-blue" onclick="generateProduct()">áƒ“áƒáƒ›áƒáƒ¢áƒ”áƒ‘áƒ áƒ“áƒ áƒ¨áƒ”áƒœáƒáƒ®áƒ•áƒ</button>
        </div>

        <div id="result-section" class="hidden">
            <hr>
            <h3 id="display-name"></h3>
            <p id="display-price"></p>
            <img id="saved-product-img" src="" style="width:100px; border-radius:8px; margin-bottom:10px;">
            <br>
            <svg id="barcode-img"></svg>
            <button class="btn-green" onclick="showScanner()">áƒ¡áƒ™áƒáƒœáƒ˜áƒ áƒ”áƒ‘áƒ˜áƒ¡ áƒ©áƒáƒ áƒ—áƒ•áƒ</button>
            <button class="btn-red" onclick="clearData()">áƒ›áƒáƒœáƒáƒªáƒ”áƒ›áƒ”áƒ‘áƒ˜áƒ¡ áƒ¬áƒáƒ¨áƒšáƒ</button>
        </div>

        <div id="scanner-section" class="hidden">
            <div id="reader"></div>
            <div id="scan-result" style="margin-top: 15px; color: #d35400; font-weight: bold;"></div>
            <div id="payment-btns" class="hidden">
                <button class="btn-blue" onclick="fakePay('card')">ğŸ’³ Pay with Card</button>
                <button class="btn-green" onclick="fakePay('cash')">ğŸ’µ Pay with Cash</button>
            </div>
        </div>
    </div>

    <script>
        let myProduct = { name: "", price: "", code: "", image: "" };

        // áƒ’áƒ•áƒ”áƒ áƒ“áƒ˜áƒ¡ áƒ©áƒáƒ¢áƒ•áƒ˜áƒ áƒ—áƒ•áƒ˜áƒ¡áƒáƒ¡ áƒ•áƒáƒ›áƒáƒ¬áƒ›áƒ”áƒ‘áƒ— áƒ¨áƒ”áƒœáƒáƒ®áƒ£áƒš áƒ›áƒáƒœáƒáƒªáƒ”áƒ›áƒ”áƒ‘áƒ¡
        window.onload = function() {
            const savedData = localStorage.getItem('myProduct');
            if (savedData) {
                myProduct = JSON.parse(savedData);
                displaySavedProduct();
            }
        };

        function previewFile() {
            const preview = document.getElementById('product-preview');
            const file = document.getElementById('pImage').files[0];
            const reader = new FileReader();
            reader.onloadend = function () {
                preview.src = reader.result;
                preview.style.display = 'block';
                myProduct.image = reader.result;
            }
            if (file) { reader.readAsDataURL(file); }
        }

        function generateProduct() {
            const name = document.getElementById('pName').value;
            const price = document.getElementById('pPrice').value;
            const file = document.getElementById('pImage').files[0];

            if (!name || !price || (!file && !myProduct.image)) {
                alert("áƒ’áƒ—áƒ®áƒáƒ•áƒ— áƒ¨áƒ”áƒáƒ•áƒ¡áƒáƒ— áƒ§áƒ•áƒ”áƒšáƒ áƒ•áƒ”áƒšáƒ˜!");
                return;
            }

            myProduct.name = name;
            myProduct.price = price;
            myProduct.code = Math.floor(100000 + Math.random() * 900000).toString();

            // áƒ•áƒ˜áƒœáƒáƒ®áƒáƒ•áƒ— áƒ‘áƒ áƒáƒ£áƒ–áƒ”áƒ áƒ¨áƒ˜
            localStorage.setItem('myProduct', JSON.stringify(myProduct));
            displaySavedProduct();
        }

        function displaySavedProduct() {
            document.getElementById('display-name').innerText = "áƒœáƒ˜áƒ•áƒ—áƒ˜: " + myProduct.name;
            document.getElementById('display-price').innerText = "áƒ¤áƒáƒ¡áƒ˜: " + myProduct.price + "â‚¾";
            document.getElementById('saved-product-img').src = myProduct.image;
            JsBarcode("#barcode-img", myProduct.code);
            document.getElementById('result-section').classList.remove('hidden');
            document.getElementById('add-section').classList.add('hidden'); // áƒ•áƒ›áƒáƒšáƒáƒ•áƒ— áƒ¤áƒáƒ áƒ›áƒáƒ¡
        }

        function clearData() {
            localStorage.removeItem('myProduct');
            location.reload();
        }

        function showScanner() {
            document.getElementById('scanner-section').classList.remove('hidden');
            const html5QrCode = new Html5Qrcode("reader");
            html5QrCode.start(
                { facingMode: "environment" }, 
                { fps: 10, qrbox: { width: 250, height: 150 } },
                (decodedText) => {
                    if (decodedText === myProduct.code) {
                        document.getElementById('scan-result').innerHTML = 
                            `<p style="color:green">áƒ¡áƒ™áƒáƒœáƒ˜áƒ áƒ”áƒ‘áƒ£áƒšáƒ˜áƒ!</p>
                             ${myProduct.name} - ${myProduct.price}â‚¾`;
                        document.getElementById('payment-btns').classList.remove('hidden');
                        html5QrCode.stop();
                    } else {
                        alert("áƒ”áƒ¡ áƒ—áƒ¥áƒ•áƒ”áƒœáƒ—áƒ•áƒ˜áƒ¡ áƒáƒ  áƒáƒ áƒ˜áƒ¡!");
                    }
                }
            ).catch(err => alert("áƒ™áƒáƒ›áƒ”áƒ áƒ˜áƒ¡ áƒœáƒ”áƒ‘áƒáƒ áƒ—áƒ•áƒ áƒ¡áƒáƒ­áƒ˜áƒ áƒáƒ"));
        }

        function fakePay(type) {
            if (type === 'card') {
                alert("áƒ“áƒáƒáƒ“áƒ”áƒ— áƒ‘áƒáƒ áƒáƒ—áƒ˜ áƒ™áƒáƒ›áƒ”áƒ áƒáƒ¡!");
                setTimeout(() => {
                    alert("áƒ’áƒáƒ“áƒáƒ®áƒ“áƒ˜áƒšáƒ˜áƒ! âœ…");
                }, 2000);
            } else {
                alert("áƒ›áƒ˜áƒ˜áƒ¦áƒ”áƒ— áƒœáƒáƒ¦áƒ“áƒ˜ áƒ¤áƒ£áƒšáƒ˜: " + myProduct.price + "â‚¾");
            }
        }
    </script>
</body>
</html>
